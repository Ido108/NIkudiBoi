<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ config.site_title }} | {{ config.subtitle }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;900&family=Rubik:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        :root {
            --primary-color: {{ config.primary_color }};
            --glass-border: rgba(255, 255, 255, 0.4);
            --glass-bg: rgba(255, 255, 255, 0.75);
            --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }

        body {
            font-family: 'Heebo', sans-serif;
            background: #f0f2f5;
            overflow: hidden;
        }

        .animated-bg {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh; z-index: -1;
            background: radial-gradient(circle at 0% 0%, #e0e7ff 0%, transparent 50%), 
                        radial-gradient(circle at 100% 100%, #e0e7ff 0%, transparent 50%),
                        radial-gradient(circle at 100% 0%, #f3e8ff 0%, transparent 50%);
            animation: bg-pulse 20s ease-in-out infinite alternate;
        }
        @keyframes bg-pulse { 0% { transform: scale(1); } 100% { transform: scale(1.1); } }

        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
        }

        .primary-btn {
            background-color: var(--primary-color);
        }
        .text-primary {
            color: var(--primary-color);
        }

        .editor-area {
            font-family: 'Rubik', sans-serif;
            line-height: 1.8;
            font-size: 1.125rem;
            background-image: linear-gradient(transparent 96%, rgba(0,0,0,0.03) 97%);
            background-size: 100% 2rem;
            background-attachment: local;
        }

        /* Loader */
        .loader-bars { display: flex; gap: 4px; }
        .loader-bar { width: 4px; height: 12px; background: white; animation: loader-wave 1s ease-in-out infinite; }
        .loader-bar:nth-child(2) { animation-delay: 0.1s; }
        .loader-bar:nth-child(3) { animation-delay: 0.2s; }
        @keyframes loader-wave { 0%, 100% { height: 12px; } 50% { height: 24px; } }
        
        /* Transitions */
        .fade-in-up { animation: fadeInUp 0.5s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .floating { animation: floating 3s ease-in-out infinite; }
        @keyframes floating { 0% { transform: translateY(0px); } 50% { transform: translateY(-5px); } 100% { transform: translateY(0px); } }
    </style>
</head>
<body class="h-screen w-screen flex flex-col text-slate-800">
    <div class="animated-bg"></div>

    <!-- Navbar -->
    <nav class="h-16 glass-panel z-50 flex items-center justify-between px-8 shrink-0 relative">
        <div class="flex items-center gap-4">
            <div class="w-10 h-10 rounded-xl primary-btn flex items-center justify-center text-white shadow-lg">
                <i class="ph-bold ph-text-aa text-2xl"></i>
            </div>
            <div>
                <h1 class="text-xl font-bold tracking-tight text-slate-900">{{ config.site_title }}</h1>
                <p class="text-xs text-slate-500 font-medium">{{ config.subtitle }}</p>
            </div>
        </div>
    </nav>

    <!-- Main -->
    <main class="flex-1 flex overflow-hidden p-6 gap-6 relative">
        <aside class="w-80 flex flex-col gap-6 fade-in-up" style="animation-delay: 0.1s;">
            
            <!-- Upload -->
            <div class="glass-panel rounded-2xl p-1 flex-1 flex flex-col relative overflow-hidden group">
                <label for="dropzone-file" class="flex-1 flex flex-col items-center justify-center w-full border-2 border-dashed border-indigo-200 rounded-xl cursor-pointer hover:bg-indigo-50/30 transition-all group-hover:shadow-inner">
                    <div class="flex flex-col items-center justify-center text-center p-4">
                        <div class="w-16 h-16 mb-4 rounded-full bg-indigo-100 flex items-center justify-center text-primary group-hover:scale-110 transition-transform">
                            <i class="ph-duotone ph-file-txt text-3xl"></i>
                        </div>
                        <p class="text-sm text-slate-700 font-medium mb-1">העלאת קובץ</p>
                        <p class="text-xs text-slate-500">או גרור לכאן קובץ TXT</p>
                        <p id="file_name" class="mt-3 text-xs font-bold text-primary bg-indigo-50 px-3 py-1 rounded-full hidden"></p>
                    </div>
                    <input id="dropzone-file" type="file" class="hidden" accept=".txt" />
                </label>
            </div>

            <!-- Action Button -->
            <button id="process_btn" class="group relative w-full py-4 primary-btn hover:brightness-110 text-white rounded-2xl shadow-lg transition-all transform hover:-translate-y-1 overflow-hidden">
                <div class="relative flex items-center justify-center gap-2 font-bold text-lg">
                    <span id="btn_text">נקד עכשיו</span>
                    <i id="btn_icon" class="ph-bold ph-magic-wand text-xl"></i>
                    <div id="loading_spinner" class="loader-bars hidden">
                        <div class="loader-bar"></div><div class="loader-bar"></div><div class="loader-bar"></div>
                    </div>
                </div>
            </button>
        </aside>

        <!-- Editors -->
        <section class="flex-1 flex flex-col gap-4 h-full min-w-0 fade-in-up" style="animation-delay: 0.2s;">
            <!-- Input -->
            <div class="flex-1 glass-panel rounded-2xl flex flex-col relative focus-within:ring-2 ring-indigo-500/30 transition-shadow">
                <div class="h-10 bg-white/40 border-b border-white/50 flex items-center justify-between px-4 backdrop-blur-sm">
                    <span class="text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2">
                        <i class="ph-bold ph-text-indent"></i> טקסט מקור
                    </span>
                    <button id="clear_btn" class="text-xs font-medium text-slate-400 hover:text-red-500 transition">נקה</button>
                </div>
                <textarea id="input_text" class="editor-area w-full h-full p-6 bg-transparent resize-none outline-none text-slate-800 placeholder-slate-400" placeholder="{{ config.welcome_message }}"></textarea>
            </div>

            <!-- Output -->
            <div class="flex-1 glass-panel rounded-2xl flex flex-col relative bg-indigo-50/30 focus-within:ring-2 ring-indigo-500/30 transition-shadow">
                <div class="h-10 bg-indigo-100/50 border-b border-indigo-200/50 flex items-center justify-between px-4 backdrop-blur-sm">
                    <span class="text-xs font-bold text-primary uppercase tracking-wider flex items-center gap-2">
                        <i class="ph-fill ph-sparkle"></i> טקסט מנוקד
                    </span>
                    <div class="flex gap-2">
                        <button id="copy_btn" class="p-1.5 rounded hover:bg-white/50 text-primary transition" disabled title="העתק"><i class="ph-bold ph-copy"></i></button>
                        <button id="download_btn" class="p-1.5 rounded hover:bg-white/50 text-primary transition" disabled title="הורד"><i class="ph-bold ph-download-simple"></i></button>
                    </div>
                </div>
                <div class="relative w-full h-full">
                    <textarea id="output_text" class="editor-area w-full h-full p-6 bg-transparent resize-none outline-none text-slate-900 font-medium" readonly></textarea>
                    <div id="empty_state" class="absolute inset-0 flex flex-col items-center justify-center text-slate-400 pointer-events-none">
                        <i class="ph-duotone ph-article text-6xl mb-2 opacity-50 floating"></i>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        const inputText = document.getElementById('input_text');
        const outputText = document.getElementById('output_text');
        const processBtn = document.getElementById('process_btn');
        const btnText = document.getElementById('btn_text');
        const btnIcon = document.getElementById('btn_icon');
        const loadingSpinner = document.getElementById('loading_spinner');
        const emptyState = document.getElementById('empty_state');

        // File Upload
        document.getElementById('dropzone-file').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => { inputText.value = e.target.result; };
                reader.readAsText(file);
                document.getElementById('file_name').textContent = file.name;
                document.getElementById('file_name').classList.remove('hidden');
            }
        });

        // Process
        processBtn.addEventListener('click', async () => {
            const text = inputText.value;
            if (!text.trim()) return;

            // Loading State
            processBtn.disabled = true;
            processBtn.classList.add('opacity-90');
            btnText.textContent = 'מעבד...';
            btnIcon.classList.add('hidden');
            loadingSpinner.classList.remove('hidden');

            try {
                const response = await fetch('/api/predict', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        text: text
                    }),
                });
                const data = await response.json();
                
                if(response.ok) {
                    outputText.value = data.result;
                    emptyState.classList.add('hidden');
                    document.getElementById('download_btn').disabled = false;
                    document.getElementById('copy_btn').disabled = false;
                } else {
                    alert("שגיאה: " + (data.detail || "נסה שנית"));
                }
            } catch (e) {
                console.error(e);
                alert("שגיאת תקשורת");
            } finally {
                processBtn.disabled = false;
                processBtn.classList.remove('opacity-90');
                btnText.textContent = 'נקד עכשיו';
                btnIcon.classList.remove('hidden');
                loadingSpinner.classList.add('hidden');
            }
        });

        // Utils
        document.getElementById('clear_btn').addEventListener('click', () => {
            inputText.value = '';
            outputText.value = '';
            emptyState.classList.remove('hidden');
        });
        
        document.getElementById('copy_btn').addEventListener('click', () => {
            navigator.clipboard.writeText(outputText.value);
        });

        document.getElementById('download_btn').addEventListener('click', () => {
            const blob = new Blob([outputText.value], {type: 'text/plain'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = 'nikud_output.txt';
            a.click();
        });
    </script>
</body>
</html>
